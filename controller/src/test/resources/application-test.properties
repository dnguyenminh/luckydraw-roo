# Test configuration
spring.main.banner-mode=off
spring.main.allow-bean-definition-overriding=true

# Database configuration for controller tests
spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=MySQL
spring.datasource.username=sa
spring.datasource.password=
spring.datasource.driver-class-name=org.h2.Driver

# Schema management - explicitly ordering scripts execution
spring.jpa.hibernate.ddl-auto=none
spring.sql.init.mode=always
spring.jpa.defer-datasource-initialization=true
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

# Explicitly specify schema script first, then data script
# Ensure schema-test.sql is only one executed
spring.sql.init.schema-locations=classpath:schema-test.sql
spring.sql.init.data-locations=classpath:data-test.sql

# Don't try to run other scripts from library jars
spring.sql.init.platform=

# Add the following to force order and provide more info
spring.sql.init.continue-on-error=false
spring.sql.init.separator=;

# Set to true to ensure schema script runs before data script
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.H2Dialect

# Disable SQL from other sources
spring.datasource.initialization-mode=never
spring.sql.init.schema-locations[0]=classpath:schema-test.sql

# Add debugging to see what's happening with SQL initialization
logging.level.org.springframework.jdbc.datasource.init=DEBUG

# Security Configuration
jwt.secret=test-jwt-secret-key-for-unit-testing-purposes-only
jwt.expiration=3600000
jwt.refresh.expiration=86400

# Mock MVC configuration
spring.mvc.pathmatch.matching-strategy=ant-path-matcher
    
# Logging Configuration
logging.level.org.springframework=INFO
logging.level.org.hibernate=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.vn.com.fecredit.app=DEBUG

# Actuator Configuration
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always

# Server Configuration
server.port=0
server.error.include-message=always
server.error.include-binding-errors=always

# CORS Configuration
spring.web.cors.allowed-origins=*
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.exposed-headers=Authorization
spring.web.cors.allow-credentials=true
spring.web.cors.max-age=3600

spring.aop.proxy-target-class=true